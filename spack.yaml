# This is a Spack Environment file.
#
# It describes a set of packages to be installed, along with
# configuration settings.
spack:
  definitions:
  # - compilers:
  #   - intel@2021.10.0
  # FIXME: What is to be done with the definitions for 'mpis' and 'serial_packages'
  - mpis:
    - openmpi@4.1.5
  - serial_packages:
    - fortranxml@4.1.2
  # - packages:
  #   - esmf@8.5.0+debug
  #   - parallelio@2.6.2 build_type=RelWithDebInfo fflags='-qno-opt-dynamic-align -convert
  #     big_endian -assume byterecl -ftz -traceback -assume realloc_lhs -fp-model source'
  #     cflags='-qno-opt-dynamic-align -fp-model precise -std=gnu99'
  #   - netcdf-c@4.9.2 build_system=cmake build_type=RelWithDebInfo
  #   - netcdf-fortran@4.6.1
  #   - fms@2023.02 precision=64 +large_file +deprecated_io ~gfs_phys ~openmp ~quad_precision
  #     build_type=RelWithDebInfo
  #   - access-om3 +install_libraries
  specs:
  - access-om3-virtual@git.2024.04.0  # FIXME: Add appropriate first version
  packages:
    access-om3:
      require:
        - '@git.v0.2.0'
        - '+install_libraries'
    esmf:
      require:
        - '@8.5.0'
        - '+debug'
    parallelio:
      require:
        - '@2.6.2'
        - build_type=RelWithDebInfo fflags='-qno-opt-dynamic-align -convert big_endian -assume byterecl -ftz -traceback -assume realloc_lhs -fp-model source' cflags='-qno-opt-dynamic-align -fp-model precise -std=gnu99'
    netcdf-c:
      require:
        - '@4.9.2'
        - 'build_system=cmake build_type=RelWithDebInfo'
    netcdf-fortran:
      require:
        - '@4.6.1'
    fms:
      require:
        - '@2023.02'
        - precision=64 +large_file +deprecated_io ~gfs_phys ~openmp ~quad_precision build_type=RelWithDebInfo
    openmpi:
      require:
        - '@4.1.5'

    all:
      compiler: [intel@19.0.5.281]

  # - matrix:
  #   - [$mpis]
  #   - [$%compilers]
  # - matrix:
  #   - [$packages]
  #   - [$^mpis]
  #   - [$%compilers]
  # - matrix:
  #   - [$serial_packages]
  #   - [$%compilers]
  view: true
  concretizer:
    unify: true
  modules:
    default:
      enable:
        - tcl
      roots:
        tcl: $spack/../release/modules
        lmod: $spack/../release/lmod
      tcl:
        hash_length: 0
        include:
          - access-om3-virtual
          - access-om3
        exclude_implicits: true
        all:
          autoload: direct
          conflict:
            - '{name}'
          environment:
            set:
              'SPACK_{name}_ROOT': '{prefix}'
        projections:
          all: '{name}/{version}'
          access-om3-virtual: '{name}/2024.04.0'
          access-om3: '{name}/v0.2.0'

  # modules:
  #   default:
  #     roots:
  #       tcl: $spack/../modules/access-om3/0.x.0
  #     tcl:
  #       naming_scheme: '{name}/{version}'
